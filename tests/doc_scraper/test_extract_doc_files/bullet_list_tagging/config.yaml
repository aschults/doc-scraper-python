sources:
- kind: doc_files
  config:
    doc_filenames:
    - data.html
transformations:
- kind: nest_bullets       
- kind: nest_sections
- kind: tag_matching
  config:
    tags:
      add:
        section: "{merged_text}"
    match_element:
      element_types:
        - Section
    variables:
      merged_text:
        section_heading_only: True
        substitutions:
        - regex: "(.)"
          substitute: "\\1"
          operation: lower
        - regex: "^\\s+"
          substitute: ""
        - regex: "\\s+$"
          substitute: ""
        - regex: "\\s+"
          substitute: "_"
- kind: tag_matching
  config:
    tags:
      add:
        bold: "Y"
    match_element:
      element_types:
        - TextRun
      required_style_sets:
      - { font-weight: "700" }
- kind: tag_matching
  config:
    tags:
      add:
        label: "{text}"
    match_element:
      element_types:
        - TextRun
      required_tag_sets:
      - { bold: Y }
    match_ancestor_list:
    -   element_types:  [ Section ]
        required_tag_sets:
        - { section: with_prefix }
    variables:
      text:
        section_heading_only: True
        substitutions:
        - regex: "(.)"
          substitute: "\\1"
          operation: lower
        - regex: "^\\s+"
          substitute: ""
        - regex: "[\\s:]+$"
          substitute: ""
- kind: tag_matching
  config:
    tags:
      add:
        for_label: "{prev_element.tags[label]}"
      ignore_errors: True
    match_element:
      element_types:
        - TextRun
    variables:
      prev_element:
        element_at:
          col: prev
- kind: strip_elements
  config:
    remove_styles_re: ['.*']
    remove_style_rules_re: ['.*']
outputs:
- kind: stdout
- kind: single_file
  config:
    output_file: /tmp/result.json
